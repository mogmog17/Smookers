<div class="container">
  <div class="row">
    <div class="col-12">
      <h1 class="mt-4 mb-4">
        <i class="fas fa-map-marker-alt"></i>
        地図情報
      </h1>
      <div class="mx-auto">
        <input id="address" type="textbox" placeholder="地図を検索", class="rounded-pill mb-3">
        <input type="button" value="検索" onclick="codeAddress()">
      </div>

      <!--地図を表示-->
      <div id='map'></div>

      <style>
        #map {
          height: 600px;
          width: 100%;
        }
      </style>

      <script>
        let map

        function initMap(){
          geocoder = new google.maps.Geocoder()

          <% @posts.each do |spot| %>
            map = new google.maps.Map(document.getElementById('map'), {
              center: {lat: <%= spot.latitude %>, lng: <%= spot.longitude %>},
              zoom: 12,
            });

            // 各地点のマーカー
            marker = new google.maps.Marker({
              position:  {lat: <%= spot.latitude %>, lng: <%= spot.longitude %>},
              map: map
            });

            // 各地点の吹き出し
            infoWindow = new google.maps.InfoWindow({

              // 吹き出しの内容
              content: '<%= spot.address %>'
            });

            // マーカーにクリックイベントを追加
            markerEvent();
          }
        <% end %>

        // マーカーをクリックしたら吹き出しを表示
        function markerEvent() {
          marker.addListener('click', function() {
            infoWindow.open(map, marker);
          });
        }
      </script>
      <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=<%= ENV['GOOGLE_MAP_KEY'] %>&callback=initMap"></script>
      <script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
      <script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script>
    </div>
  </div>
</div>